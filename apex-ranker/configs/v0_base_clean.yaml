version: 0
# Base configuration for APEX-Ranker v0 using CLEAN dataset
# Dataset: 2023-2024 ONLY (cleaned high-NULL columns, g5 schema)

data:
  parquet_path: ../output_g5/datasets/ml_dataset_2023_2024_clean.parquet
  metadata_path: null
  feature_groups_config: configs/feature_groups_dataset145.yaml
  feature_groups:
  - g5_core
  - g5_top_corr
  optional_groups: []
  use_plus30: false
  lookback: 90
  min_stocks_per_day: 80
  date_column: Date
  code_column: Code
  target_columns:
    1: ret_prev_1d
    5: ret_prev_5d
    10: ret_prev_10d
    20: ret_prev_20d

normalization:
  mode: cross_section_z
  clip_sigma: 5.0

train:
  horizons:
  - 1
  - 5
  - 10
  - 20
  epochs: 50
  lr: 0.0005
  weight_decay: 0.0001
  grad_clip: 0.5
  val_days: 120
  log_interval: 10
  amp: true
  device: auto
  num_workers: 0
  pin_memory: true
  prefetch_factor: 4
  persistent_workers: true
  warmup_epochs: 3
  warmup_start_factor: 0.1
  early_stopping:
    patience: 3
    metric: short_term_score
    min_delta: 0.0
  evaluation:
    splitter: purged_kfold
    purged_kfold:
      n_splits: 5
      embargo_days: 5
  time_decay_tau_days: 120
  use_ema: true
  ema_beta: 0.999

eval:
  k_ratio: 0.07
  ndcg_beta: 1.0
  es_weights: "0.6,0.3,0.1"

selection:
  default:
    k_ratio: 0.07
    k_min: 5
    sign: 1
  horizons:
    "5":
      sign: 1
    "10":
      sign: 1
    "20":
      sign: 1

model:
  d_model: 256
  depth: 4
  patch_len: 16
  stride: 8
  n_heads: 8
  dropout: 0.2

loss:
  listnet:
    weight: 1.0
    tau: 0.4
    topk: null
  ranknet:
    weight: 0.5
    neg_sample: 4096
  mse:
    weight: 0.1
  turnover:
    weight: 0.001
