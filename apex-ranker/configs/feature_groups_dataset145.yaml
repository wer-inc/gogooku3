version: 1

groups:
  g5_core:
    include:
      # gogooku5-style price/volume columns
      - AdjustmentOpen
      - AdjustmentHigh
      - AdjustmentLow
      - AdjustmentClose
      - AdjustmentVolume
      - TurnoverValue
      # gogooku5 return columns
      - ret_prev_1d
      - ret_prev_5d
      - ret_prev_10d
      - ret_prev_20d
      # liquidity / volatility
      - dollar_volume
      - volatility_20d
      - volume_ma_5
      - volume_ma_20
      # TOPIX beta/alpha
      - beta60_topix
      - alpha60_topix
      # graph features
      - graph_degree
      - graph_peer_corr_mean
      - graph_peer_corr_max
      - graph_degree_roll_mean_20d
      - graph_degree_roll_std_20d
      - graph_degree_zscore_20d
      - graph_peer_corr_mean_roll_mean_20d
      - graph_peer_corr_mean_roll_std_20d
      - graph_peer_corr_mean_zscore_20d
      - graph_peer_corr_max_roll_mean_20d
      - graph_peer_corr_max_roll_std_20d
      - graph_peer_corr_max_zscore_20d

  g5_top_corr:
    include:
      # Macro / TOPIX volatility and drawdown
      - topix_vol_z_252d
      - topix_drawdown_60d
      - topix_drawdown_60d_roll_mean_20d
      - topix_atr14_zscore_20d
      - topix_natr14_zscore_20d
      - topix_rsi_14_zscore_20d
      # Index option (skew / IV / SQ timing)
      - idxopt_days_to_sq_sector_mean
      - idxopt_days_to_sq_roll_mean_20d
      - idxopt_days_to_sq_zscore_20d
      - idxopt_iv_atm_30d
      - idxopt_iv_atm_30d_sector_mean
      - idxopt_iv_atm_30d_roll_mean_20d
      - idxopt_skew_25
      - idxopt_skew_25_sector_mean
      - idxopt_skew_25_zscore_20d
      - idxopt_underlying_price_zscore_20d
      # Foreign / retail flow divergence signals
      - retail_institutional_divergence
      - retail_institutional_divergence_sector_mean
      - foreign_persistence
      - foreign_persistence_sector_mean
      - foreign_sentiment
      - foreign_sentiment_sector_mean
      # Macro VIX / VVMD regime
      - macro_vix_ret_10d
      - macro_vix_close
      - macro_vix_log_close
      - macro_vvmd_mom_qqq_63d
      # Sector / cross-sectional momentum
      - log_returns_10d_sector_mean
      - sec_ret_5d_eq
      - sec_ret_5d_eq_sector_mean
      - sec_ret_5d_eq_roll_mean_20d
      - sec_ret_5d_eq_rolling_sharpe
      - idx_ret_prev_10d_sector_mean
      - topix_time_since_peak_60d_sector_mean
      - topix_ret_prev_20d_topix
      - topix_ret_prev_20d_topix_sector_mean
      - topix_ret_prev_5d_zscore_20d
      - price_to_sma20_sector_mean
  g5_short_term:
    # Short-term (1d+5d) optimized features
    # Criteria: NULL <10%, high signal for short-term prediction

    # NOTE: Graph features excluded (not available in dataset)
    include:
      # Core price/volume features (NULL <5%)
      - AdjustmentOpen
      - AdjustmentHigh
      - AdjustmentLow
      - AdjustmentClose
      - AdjustmentVolume
      - TurnoverValue

      # Short-term returns (NULL <10%)
      - ret_prev_1d      # 3.0% NULL
      - ret_prev_5d      # 10.0% NULL

      # Liquidity features (NULL <5%)
      - dollar_volume    # 0.7% NULL
      - volatility_20d   # 5.1% NULL
      - volume_ma_5      # 0.3% NULL
      - volume_ma_20     # 0.1% NULL

      # Macro regime features (NULL <4%)
      - topix_drawdown_60d               # 0.0% NULL
      - topix_drawdown_60d_roll_mean_20d
      - topix_atr14_zscore_20d
      - topix_natr14_zscore_20d
      - topix_rsi_14_zscore_20d
      - topix_ret_prev_1d
      - topix_ret_overnight
      - topix_ret_intraday
      - topix_atr14
      - beta60_topix
      - alpha60_topix
      - macro_vix_ret_10d                # 3.7% NULL
      - macro_vix_close                  # 3.7% NULL
      - macro_vix_log_close

      # Index options (NULL 0%)
      - idxopt_iv_atm_30d                # 0.0% NULL
      - idxopt_iv_atm_30d_sector_mean
      - idxopt_iv_atm_30d_roll_mean_20d
      - idxopt_skew_25                   # 0.0% NULL
      - idxopt_skew_25_sector_mean
      - idxopt_skew_25_zscore_20d
      - idxopt_underlying_price_zscore_20d

      # Sector momentum (NULL varies, generally <10%)
      - log_returns_10d_sector_mean
      - sec_ret_5d_eq
      - sec_ret_5d_eq_sector_mean
      - sec_ret_5d_eq_roll_mean_20d
      - sec_ret_5d_eq_rolling_sharpe
      - idx_ret_prev_10d_sector_mean
      - topix_ret_prev_5d_zscore_20d
      - price_to_sma20_sector_mean

      # Realized quantile features (63-day window)
      - rq_63_10
      - rq_63_50
      - rq_63_90

      # Earnings event features (restored in Clean v2)
      # NOTE: fs_E_event_date excluded (Date type, not numeric feature)
      - days_to_earnings
      - fs_days_since_E
      - fs_window_e_pm1
      - fs_window_e_pp3
      - fs_window_e_pp5

      # Float / margin / crowding features (restored in Clean v2)
      - margin_long_pct_tradable
      - crowding_dmi
      - float_turnover_pct_tradable
      - float_turnover_pct_z20
      - weekly_margin_long_pct_tradable
      - crowding_margin
      - crowding_breakdown
      - crowding_short
      - crowding_score

      # Technical indicators for short-term
      # NOTE: gogooku5 dataset uses ret_prev_* and idr_atr / bb_bw / bb_pct_b
      # instead of returns_* / atr_14 / bb_width / bb_position.
      - log_returns_5d
      - sma_5
      - sma_20
      - ema_5
      - ema_20
      - price_to_sma5
      - price_to_sma20
      - volume_ratio_5
      - volume_ratio_20
      - rsi_2
      - rsi_14
      - idr_atr
      - bb_bw
      - bb_pct_b

  g5_mkt_flow_core:
    # Net flow ratios (20d z-score) for foreigners/individuals/total,
    # plus divergence between foreigners vs individuals
    include:
      - mkt_flow_flow_foreigners_net_ratio_zscore_20d
      - mkt_flow_flow_individuals_net_ratio_zscore_20d
      - mkt_flow_flow_divergence_foreigners_vs_individuals_zscore_20d
      - mkt_flow_flow_total_net_zscore_20d

  g5_idxopt_rr:
    # 25Δ Risk Reversal (call wing IV minus put wing IV)
    include:
      - idxopt_rr_25

  g5_nt_basis:
    # Equity vs index context: NT ratio + TOPIX futures basis tilts
    include:
      - idx_ratio_nt_ratio           # NK225/TOPIXレベル比（要再ビルドで反映）
      - idx_spread_nt_ratio_1d       # NK225 vs TOPIXリターンスプレッド
      - fut_topix_basis              # 先物ベーシス
      - basis_gate                   # β補正済みベーシスゲート
      - basis_gate_zscore_20d

  g5_overheat_margin:
    # Overheating / pain gauges for margin traders
    include:
      - margin_pain_index
      - mpi_drawdown_z20
      - mpi_dist_to_limit_z20
      - margin_long_pct_float_z20

  all_features:
    include:
      - shares_outstanding
      - Open
      - High
      - Low
      - Close
      - Volume
      - TurnoverValue
      - returns_1d
      - returns_5d
      - returns_10d
      - returns_20d
      - returns_60d
      - returns_120d
      - log_returns_1d
      - log_returns_5d
      - log_returns_10d
      - log_returns_20d
      - volatility_5d
      - volatility_10d
      - volatility_20d
      - volatility_60d
      - realized_volatility
      - pk_vol_20
      - pk_vol_60
      - rs_vol_20
      - rs_vol_60
      - yz_vol_20
      - yz_vol_60
      - vov_20
      - vov_60
      - sma_5
      - sma_10
      - sma_20
      - sma_60
      - sma_120
      - ema_5
      - ema_10
      - ema_20
      - ema_60
      - ema_200
      - price_to_sma5
      - price_to_sma20
      - price_to_sma60
      - ma_gap_5_20
      - ma_gap_20_60
      - high_low_ratio
      - close_to_high
      - close_to_low
      - volume_ma_5
      - volume_ma_20
      - volume_ratio_5
      - volume_ratio_20
      - turnover_rate
      - dollar_volume
      - amihud_20
      - rsi_2
      - rsi_14
      - macd
      - macd_signal
      - macd_histogram
      - atr_14
      - adx_14
      - stoch_k
      - bb_width
      - bb_position
      - mkt_ret_1d
      - mkt_ret_5d
      - mkt_ret_10d
      - mkt_ret_20d
      - mkt_ema_5
      - mkt_ema_20
      - mkt_ema_60
      - mkt_ema_200
      - mkt_dev_20
      - mkt_gap_5_20
      - mkt_ema20_slope_3
      - mkt_vol_20d
      - mkt_atr_14
      - mkt_natr_14
      - mkt_bb_pct_b
      - mkt_bb_bw
      - mkt_dd_from_peak
      - mkt_big_move_flag
      - mkt_ret_1d_z
      - mkt_vol_20d_z
      - mkt_bb_bw_z
      - mkt_dd_from_peak_z
      - mkt_bull_200
      - mkt_trend_up
      - mkt_high_vol
      - mkt_squeeze
      - beta_60d
      - alpha_1d
      - alpha_5d
      - rel_strength_5d
      - trend_align_mkt
      - alpha_vs_regime
      - idio_vol_ratio
      - beta_stability_60d
      - x_trend_intensity
      - x_trend_intensity_g
      - x_rel_sec_mom
      - x_z_sec_gap_mom
      - x_mom_sh_5
      - x_mom_sh_10
      - x_mom_sh_5_mktneu
      - x_rvol5_dir
      - x_rvol5_bb
      - x_squeeze_pressure
      - x_credit_rev_bias
      - x_pead_effect
      - x_pead_times_mkt
      - x_rev_gate
      - x_bo_gate
      - x_alpha_meanrev_stable
      - x_flow_smart_rel
      - x_foreign_relsec
      - x_tri_align
      - x_bbpos_rvol5
      - x_bbneg_rvol5
      - x_liquidityshock_mom
      - x_dmi_impulse_dir
      - x_breadth_rel
      - ret_prev_1d_vs_sec
      - ret_prev_1d_in_sec_z
      - ret_prev_1d_rank_in_sec
      - ret_prev_5d_vs_sec
      - ret_prev_5d_in_sec_z
      - ret_prev_10d_vs_sec
      - ret_prev_10d_in_sec_z
      - volume_in_sec_z
      - volume_rank_in_sec
      - rsi14_in_sec_z
      - rv20_in_sec_z
      - macd_slope_in_sec_z
      - vcm_in_sec_z
      - rsi_vol_in_sec_z
      - is_sec_cs_valid
      - alpha_vs_sec_1d
      - z_in_sec_returns_5d
      - z_in_sec_ma_gap_5_20
      - sec_small_flag
      - sec_ema_5
      - sec_ema_20
      - sec_gap_5_20
      - sec_vol_20_z
      - sec_ret_1d_eq
      - sec_ret_5d_eq
      - sec_ret_20d_eq
      - sec_ret_1d_mcap
      - sec_ret_5d_mcap
      - sec_ret_20d_mcap
      - sec_mom_20
      - sec_vol_20
      - flow_foreign_net_ratio
      - flow_individual_net_ratio
      - flow_activity_ratio
      - foreign_share_activity
      - breadth_pos
      - flow_foreign_net_z
      - flow_individual_net_z
      - flow_activity_z
      - flow_smart_idx
      - flow_smart_mom4
      - flow_shock_flag
      - flow_impulse
      - flow_days_since
      - stmt_yoy_sales
      - stmt_yoy_op
      - stmt_yoy_np
      - stmt_opm
      - stmt_npm
      - stmt_progress_op
      - stmt_progress_np
      - stmt_rev_fore_op
      - stmt_rev_fore_np
      - stmt_rev_fore_eps
      - stmt_rev_div_fore
      - stmt_roe
      - stmt_roa
      - stmt_change_in_est
      - stmt_nc_flag
      - stmt_imp_statement
      - stmt_days_since_statement
      - is_rsi2_valid
      - is_ema5_valid
      - is_ema10_valid
      - is_ema20_valid
      - is_ema200_valid
      - is_valid_ma
      - is_flow_valid
      - is_stmt_valid
      - is_halt_20201001
      - margin_long_tot
      - margin_short_tot
      - margin_total_gross
      - margin_credit_ratio
      - margin_imbalance
      - margin_d_long_wow
      - margin_d_short_wow
      - margin_d_net_wow
      - margin_d_ratio_wow
      - long_z52
      - short_z52
      - margin_gross_z52
      - ratio_z52
      - margin_long_to_adv20
      - margin_short_to_adv20
      - margin_d_long_to_adv20
      - margin_d_short_to_adv20
      - margin_impulse
      - margin_days_since
      - is_margin_valid
      - margin_issue_type
      - is_borrowable
      - target_1d
      - target_5d
      - target_10d
      - target_20d
      - target_1d_binary
      - target_5d_binary
      - target_10d_binary
      - feat_ret_1d
      - feat_ret_5d
      - feat_ret_10d
      - feat_ret_20d
      - stmt_revenue_growth
      - stmt_profit_margin
      - flow_breadth_pos
      - flow_foreign_share
      - flow_foreign_net_pos
      - flow_activity_high
      - flow_activity_low
      - flow_smart_pos
      - sec17_onehot_-1
      - sec17_onehot_0
      - sec17_onehot_1
      - sec17_onehot_2
      - sec17_onehot_3
      - sec17_onehot_4
      - sec17_onehot_5
      - sec17_onehot_6
      - sec17_onehot_7
      - sec17_onehot_8
      - sec17_onehot_10
      - sec17_onehot_11
      - sec17_onehot_12
      - sec17_onehot_13
      - sec17_onehot_14
      - sec17_onehot_15
      - sec17_onehot_16
      - sec17_onehot_other
      - sec33_daily_freq
      - sec17_onehot_17
      - sec17_onehot_9
      - mkt_bull_20d
      - mkt_high_vol_regime
      - graph_degree
      - graph_clustering
      - graph_avg_neigh_deg
      - graph_core
      - graph_degree_centrality
      - graph_closeness
      - graph_pagerank
      - graph_comp_size
      - graph_comp_id
      - graph_degree_in_comp
      - graph_local_density
      - graph_isolated
      - graph_degree_z
      - peer_count
      - peer_corr_mean
      - graph_pagerank_share_comp
      - graph_degree_z_in_comp
      - graph_pagerank_z_in_comp
      - margin_net
      - margin_std_share_long
      - margin_std_share_short
      - margin_neg_share_long
      - margin_neg_share_short
      - margin_gross_mom4
      - dmi_long
      - dmi_short
      - dmi_net
      - dmi_total
      - dmi_credit_ratio
      - dmi_imbalance
      - dmi_short_long_ratio
      - dmi_std_share_long
      - dmi_std_share_short
      - dmi_neg_share_long
      - dmi_neg_share_short
      - dmi_d_long_1d
      - dmi_d_short_1d
      - dmi_d_net_1d
      - dmi_d_ratio_1d
      - dmi_z26_short
      - dmi_z26_long
      - dmi_z26_total
      - dmi_z26_d_short_1d
      - dmi_reason_restricted
      - dmi_reason_dailypublication
      - dmi_reason_monitoring
      - dmi_reason_restrictedbyjsf
      - dmi_reason_precautionbyjsf
      - dmi_reason_unclearorseconalert
      - dmi_reason_count
      - dmi_tse_reg_level
      - dmi_long_to_adv20
      - dmi_short_to_adv20
      - dmi_total_to_adv20
      - dmi_d_long_to_adv1d
      - dmi_d_short_to_adv1d
      - dmi_d_net_to_adv1d
      - dmi_impulse
      - dmi_days_since_pub
      - dmi_days_since_app
      - ss_sec33_short_share
      - ss_sec33_restrict_share
      - ss_sec33_short_turnover
      - ss_sec33_short_share_d1
      - ss_sec33_restrict_share_d1
      - ss_sec33_short_mom5
      - ss_sec33_short_accel
      - ss_mkt_short_share
      - ss_mkt_restrict_share
      - ss_mkt_short_breadth_q80
      - ss_sec33_short_share_z60
      - ss_sec33_short_turnover_z252
      - ss_rel_short_share
      - ss_rel_restrict_share
      - ss_cond_pressure
      - ss_squeeze_setup
      - rsi_delta
      - bb_bw
      - z_close_20
      - beta_60d_raw
      - beta_20d_raw
      - beta_rolling
      - is_section_fallback
      - foreigners_net_ratio
      - individuals_net_ratio
      - activity_ratio
      - activity_z
      - smart_money_idx
      - smart_money_mom4
      - days_since_flow
      - target_20d_binary
      - rsi_vol_interact
      - vol_confirmed_mom
      - macd_hist_slope
      - volume_accel
      - lag_returns_1d
      - rank_ret_prev_1d
    masks: []
