# ===========================================
# Log Rotation Configuration for gogooku3-standalone
# ===========================================

# Global settings
compress
compresscmd /bin/gzip
uncompresscmd /bin/gunzip
compressext .gz
compressoptions -9
copytruncate
create 0644 root root
dateext
dateformat -%Y%m%d-%s
delaycompress
extension .log
missingok
notifempty
olddir /var/log/gogooku3/archive
rotate 5
size 50M
sharedscripts
su root root

# Main application logs
/home/ubuntu/gogooku3-standalone/logs/*.log {
    daily
    rotate 7
    size 50M
    compress
    delaycompress
    missingok
    notifempty
    create 0644 ubuntu ubuntu
    postrotate
        # Signal application to reopen log files (if needed)
        # This depends on the application logging configuration
        # For Python applications using logging.handlers.RotatingFileHandler,
        # the copytruncate option above handles this automatically
    endscript
}

# ML training logs
/home/ubuntu/gogooku3-standalone/logs/ml_training.log {
    daily
    rotate 7
    size 100M
    compress
    delaycompress
    missingok
    notifempty
    create 0644 ubuntu ubuntu
}

# Safe training logs
/home/ubuntu/gogooku3-standalone/logs/safe_training.log {
    daily
    rotate 7
    size 100M
    compress
    delaycompress
    missingok
    notifempty
    create 0644 ubuntu ubuntu
}

# Legacy logs directory (if exists)
/home/ubuntu/gogooku3-standalone/_logs/**/*.log {
    daily
    rotate 3
    size 25M
    compress
    delaycompress
    missingok
    notifempty
    create 0644 ubuntu ubuntu
}

# Docker container logs (if managed externally)
/var/log/docker/containers/gogooku3-*.log {
    daily
    rotate 3
    size 25M
    compress
    delaycompress
    missingok
    notifempty
    postrotate
        docker restart $(docker ps -q --filter name=gogooku3-*)
    endscript
}

# ===========================================
# Installation Instructions
# ===========================================

# 1. Install logrotate (if not already installed)
# sudo apt-get update && sudo apt-get install -y logrotate

# 2. Copy this file to system configuration
# sudo cp ops/logrotate.conf /etc/logrotate.d/gogooku3

# 3. Create log archive directory
# sudo mkdir -p /var/log/gogooku3/archive
# sudo chown ubuntu:ubuntu /var/log/gogooku3/archive

# 4. Test configuration
# sudo logrotate -d /etc/logrotate.d/gogooku3

# 5. Run manually (optional)
# sudo logrotate -f /etc/logrotate.d/gogooku3

# 6. Verify rotation
# ls -la /var/log/gogooku3/archive/

# ===========================================
# Cron Integration
# ===========================================

# Add to /etc/cron.daily/logrotate (if not already present)
# This is typically already configured in most Linux distributions

# ===========================================
# Monitoring Integration
# ===========================================

# Log rotation events can be monitored via:
# - System logs: /var/log/syslog
# - Logrotate logs: /var/log/cron (if cron-based)
# - Custom monitoring: Check archive directory size and file counts
