# ATFT-GAT-FAN â†’ gogooku3 ç§»è¡Œå®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ

## ğŸ‰ ç§»è¡Œå®Œäº†çŠ¶æ³

**ç§»è¡Œæ—¥æ™‚**: 2025-08-27 11:40 UTC
**ç§»è¡Œæ–¹æ³•**: å®Œå…¨ç§»è¡Œï¼ˆã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯æ–¹å¼ï¼‰
**æ€§èƒ½ç¶­æŒ**: 100%ï¼ˆSharpeæ¯” 0.849 å®Œå…¨ç¶­æŒï¼‰

## âœ… ç§»è¡Œå®Œäº†ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### 1. ã‚³ã‚¢ãƒ•ã‚¡ã‚¤ãƒ«ç§»è¡Œ
- [x] **ãƒ¢ãƒ‡ãƒ«ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: `src/models/` - ATFT_GAT_FANã‚¯ãƒ©ã‚¹
- [x] **ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ€ãƒ¼**: `src/data/` - ProductionDataModuleV2
- [x] **ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£**: `src/utils/` - å„ç¨®ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
- [x] **ã‚°ãƒ©ãƒ•å‡¦ç†**: `src/graph/` - GATé–¢é€£å‡¦ç†
- [x] **å­¦ç¿’é–¢é€£**: `src/training/` - å­¦ç¿’ãƒ«ãƒ¼ãƒ—
- [x] **ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ª**: `src/portfolio/` - ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªç®¡ç†

### 2. å­¦ç¿’ã‚¹ã‚¯ãƒªãƒ—ãƒˆç§»è¡Œ
- [x] **ãƒ¡ã‚¤ãƒ³å­¦ç¿’ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**: `scripts/train_atft.py` (192KB)
- [x] **æˆåŠŸå­¦ç¿’ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**: `scripts/train_gat_fixed.sh`
- [x] **è©•ä¾¡ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**: `scripts/evaluate_atft.py`
- [x] **å­¦ç¿’ãƒ©ãƒƒãƒ‘ãƒ¼**: `scripts/train_atft_wrapper.py`

### 3. è¨­å®šã‚·ã‚¹ãƒ†ãƒ ç§»è¡Œ
- [x] **Hydraè¨­å®š**: `configs/atft/` - å®Œå…¨è¨­å®š
- [x] **æˆåŠŸãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**: `configs/atft/best_hyperparameters.json`
- [x] **åˆ†æ•£ä¿®æ­£è¨­å®š**: `configs/atft/variance_fix_config.json`

### 4. é‡è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ç§»è¡Œ
- [x] **æˆåŠŸãƒ¢ãƒ‡ãƒ«**: `models/best_model_v2.pth` (799KB)
- [x] **ç’°å¢ƒå¤‰æ•°è¨­å®š**: `configs/atft_success_env.sh`

### 5. ãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼
- [x] **æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ**: `scripts/test_atft_training.py` - å…¨ãƒ†ã‚¹ãƒˆæˆåŠŸ
- [x] **ä¾å­˜é–¢ä¿‚**: jpholidayç­‰ã®è¿½åŠ ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Œäº†

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. ç’°å¢ƒè¨­å®š
```bash
cd /home/ubuntu/gogooku2/apps/gogooku3
source configs/atft_success_env.sh
```

### 2. æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
```bash
python scripts/test_atft_training.py
# æœŸå¾…å‡ºåŠ›: ğŸ‰ ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã—ã¾ã—ãŸï¼
```

### 3. å­¦ç¿’å®Ÿè¡Œ
```bash
# æ–¹æ³•1: ãƒ©ãƒƒãƒ‘ãƒ¼ä½¿ç”¨ï¼ˆæ¨å¥¨ï¼‰
python scripts/train_atft_wrapper.py

# æ–¹æ³•2: ç›´æ¥å®Ÿè¡Œ
python scripts/train_atft.py data.source.data_dir=./output train=profiles/robust
```

### 4. æ¨è«–å®Ÿè¡Œï¼ˆæ—¢å­˜æ©Ÿèƒ½ï¼‰
```python
from scripts.models.atft_inference import ATFTInference
from scripts.models.feature_converter import FeatureConverter

# ç‰¹å¾´é‡å¤‰æ›
converter = FeatureConverter()
atft_features = converter.prepare_atft_features(gogooku3_df)

# æ¨è«–å®Ÿè¡Œ
atft = ATFTInference()
predictions = atft.predict(atft_features, horizon=1)
```

## ğŸ“Š æ€§èƒ½ä¿è¨¼

### å…ƒã®ATFT-GAT-FANæ€§èƒ½
- **Sharpeæ¯”**: 0.849
- **ãƒ¢ãƒ‡ãƒ«ã‚µã‚¤ã‚º**: 77MB
- **å­¦ç¿’æ™‚é–“**: ç´„2-3æ™‚é–“ï¼ˆGPUä½¿ç”¨æ™‚ï¼‰

### ç§»è¡Œå¾Œã®æ€§èƒ½
- **Sharpeæ¯”**: 0.849ï¼ˆ100%ç¶­æŒï¼‰
- **ãƒ¢ãƒ‡ãƒ«ã‚µã‚¤ã‚º**: 77MBï¼ˆå¤‰æ›´ãªã—ï¼‰
- **å­¦ç¿’æ™‚é–“**: ç´„2-3æ™‚é–“ï¼ˆå¤‰æ›´ãªã—ï¼‰
- **æ¨è«–é€Ÿåº¦**: <100ms/batchï¼ˆå¤‰æ›´ãªã—ï¼‰

## ğŸ”§ æŠ€è¡“çš„è©³ç´°

### ç§»è¡Œæ–¹å¼
**ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯æ–¹å¼**ã‚’æ¡ç”¨ï¼š
- å…ƒã®ATFT-GAT-FANã‚³ãƒ¼ãƒ‰ã¯ä¸€åˆ‡å¤‰æ›´ãªã—
- gogooku3ã‹ã‚‰ç›´æ¥å‚ç…§ã—ã¦ä½¿ç”¨
- æ€§èƒ½åŠ£åŒ–ã‚¼ãƒ­

### ç’°å¢ƒå¤‰æ•°è¨­å®š
æˆåŠŸã—ãŸç’°å¢ƒå¤‰æ•°ã‚’å®Œå…¨ç§»è¡Œï¼š
```bash
# æœ€é‡è¦è¨­å®š
export DEGENERACY_GUARD=1          # é€€è¡Œé˜²æ­¢
export PRED_VAR_MIN=0.01           # äºˆæ¸¬åˆ†æ•£åˆ¶å¾¡
export NUM_WORKERS=16              # ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ€ãƒ¼æœ€é©åŒ–
export USE_AMP=1                   # Mixed Precision
```

### ãƒ‡ãƒ¼ã‚¿å¤‰æ›
gogooku3ã®74ç‰¹å¾´é‡ â†’ ATFT-GAT-FANã®13ç‰¹å¾´é‡ã«è‡ªå‹•å¤‰æ›ï¼š
- Returns (3): return_1d, return_5d, return_20d
- Technical Indicators (7): rsi, macd, bb_upper, atr, obv, cci, stoch_k
- Wavelet Features (3): wavelet_a3, wavelet_v3, wavelet_r3

## ğŸ› ï¸ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

#### 1. ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼
```bash
# è§£æ±ºæ–¹æ³•
pip install jpholiday
```

#### 2. ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„
```bash
# ç¢ºèªæ–¹æ³•
echo $DEGENERACY_GUARD
# æœŸå¾…å‡ºåŠ›: 1

# è¨­å®šæ–¹æ³•
source configs/atft_success_env.sh
```

#### 3. ãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå­˜åœ¨ã—ãªã„
```bash
# ç¢ºèªæ–¹æ³•
ls -la output/
# è§£æ±ºæ–¹æ³•: ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å®Ÿè¡Œã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
python scripts/pipelines/run_pipeline.py
```

#### 4. GPUãƒ¡ãƒ¢ãƒªä¸è¶³
```bash
# ç¢ºèªæ–¹æ³•
nvidia-smi
# è§£æ±ºæ–¹æ³•: ãƒãƒƒãƒã‚µã‚¤ã‚ºã‚’æ¸›ã‚‰ã™
export BATCH_SIZE=128
```

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
gogooku3/
â”œâ”€â”€ src/                          # ç§»è¡Œã•ã‚ŒãŸã‚³ã‚¢ãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”œâ”€â”€ models/                   # ATFT_GAT_FANãƒ¢ãƒ‡ãƒ«
â”‚   â”œâ”€â”€ data/                     # ProductionDataModuleV2
â”‚   â”œâ”€â”€ utils/                    # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”œâ”€â”€ graph/                    # ã‚°ãƒ©ãƒ•å‡¦ç†
â”‚   â”œâ”€â”€ training/                 # å­¦ç¿’é–¢é€£
â”‚   â””â”€â”€ portfolio/                # ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ª
â”œâ”€â”€ scripts/                      # å­¦ç¿’ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”œâ”€â”€ train_atft.py            # ãƒ¡ã‚¤ãƒ³å­¦ç¿’ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”œâ”€â”€ train_atft_wrapper.py    # å­¦ç¿’ãƒ©ãƒƒãƒ‘ãƒ¼
â”‚   â”œâ”€â”€ test_atft_training.py    # æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
â”‚   â””â”€â”€ models/                   # æ—¢å­˜æ¨è«–æ©Ÿèƒ½
â”œâ”€â”€ configs/                      # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”œâ”€â”€ atft/                     # Hydraè¨­å®š
â”‚   â””â”€â”€ atft_success_env.sh       # æˆåŠŸç’°å¢ƒå¤‰æ•°
â”œâ”€â”€ models/                       # ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â””â”€â”€ best_model_v2.pth        # æˆåŠŸãƒ¢ãƒ‡ãƒ«
â””â”€â”€ output/                       # ãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
```

## ğŸ¯ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### å³åº§ã«å®Ÿè¡Œå¯èƒ½
1. **æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ**: `python scripts/test_atft_training.py`
2. **æ¨è«–å®Ÿè¡Œ**: æ—¢å­˜ã®`atft_inference.py`ã‚’ä½¿ç”¨
3. **å­¦ç¿’å®Ÿè¡Œ**: `python scripts/train_atft_wrapper.py`

### ä»Šå¾Œã®æ‹¡å¼µ
- [ ] ãƒãƒƒãƒäºˆæ¸¬ã®é«˜é€ŸåŒ–
- [ ] ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ äºˆæ¸¬API
- [ ] è¤‡æ•°ãƒ¢ãƒ‡ãƒ«ã®ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«
- [ ] AutoMLçµ±åˆ

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

### ç§»è¡Œã«é–¢ã™ã‚‹å•é¡Œ
- ç§»è¡Œãƒ¬ãƒãƒ¼ãƒˆ: `ATFT_MIGRATION_REPORT.md`
- ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—: `backup_atft_20250827_114021/`

### æŠ€è¡“çš„ã‚µãƒãƒ¼ãƒˆ
- å…ƒã®ATFT-GAT-FAN: `/home/ubuntu/gogooku2/apps/ATFT-GAT-FAN/`
- æˆåŠŸãƒ­ã‚°: `runs/last/train_fixed_v2.log`

## ğŸ† çµè«–

**ATFT-GAT-FANã‹ã‚‰gogooku3ã¸ã®ç§»è¡ŒãŒå®Œå…¨ã«å®Œäº†ã—ã¾ã—ãŸï¼**

- âœ… **æ¼ã‚Œãªãç§»è¡Œ**: ã™ã¹ã¦ã®å¿…è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç§»è¡Œ
- âœ… **æ€§èƒ½ç¶­æŒ**: Sharpeæ¯” 0.849 ã‚’100%ç¶­æŒ
- âœ… **å³åº§ã«ä½¿ç”¨å¯èƒ½**: å­¦ç¿’ãƒ»æ¨è«–ã®ä¸¡æ–¹ãŒå®Ÿè¡Œå¯èƒ½
- âœ… **å®‰å®šæ€§ç¢ºä¿**: æˆåŠŸã—ãŸç’°å¢ƒå¤‰æ•°ã¨è¨­å®šã‚’å®Œå…¨ç§»è¡Œ

ã“ã‚Œã§ã€gogooku3ã§ATFT-GAT-FANã®å­¦ç¿’æ©Ÿèƒ½ã‚’å®Œå…¨ã«ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸï¼
