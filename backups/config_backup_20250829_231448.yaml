defaults:
  - _self_
  - data: jpx_large_scale  # プロダクション用データ設定
  - model: atft_gat_fan
  - train: production  # プロダクション用設定
  - hardware: default  # ハードウェア設定（デフォルト）
  - override hydra/hydra_logging: default
  - override hydra/job_logging: jst

# グローバル設定
project:
  name: ATFT-GAT-FAN
  seed: 42
  deterministic: true

# 実行モード
mode: train  # train, evaluate, predict, serve

# デバッグ設定
debug:
  enabled: false
  fast_dev_run: 10
  profiler: false
  detect_anomaly: false

# パス設定
paths:
  root: .
  data: data
  models: models
  logs: logs

# データ設定
data:
  graph_builder:
    # 実データディレクトリを指す data.source.data_dir を既定で参照
    source_glob: "${data.source.data_dir}/*.parquet"
    lookback: 60
    k: 15
    ewm_halflife: 20
    shrinkage_gamma: 0.05
    min_obs: 40
    size_tau: 1.0
    cache_dir: "graph_cache"
    # リーク防止のため label_* は候補から外す
    return_cols: ["return_1d", "feat_ret_1d"]
    sector_col: "sector33"
    log_mktcap_col: "log_mktcap"
    method: "ewm_demean"
    symmetric: true

# ログ設定
logging:
  level: INFO

# 改善機能設定（Phase 1: 基本改善有効化）
improvements:
  # モデル改善
  output_head_small_init: true   # small-init + LayerScale
  gat_temperature: 1.0          # GAT温度パラメータ（0.7-1.3）
  gat_alpha_min: 0.05           # GAT α下限緩和
  edge_dropout_p: 0.0           # Edge Dropout（デフォルトOFF）
  freq_dropout_p: 0.0           # Freq Dropout（Phase 3で有効化）
  freq_dropout_min_width: 0.05
  freq_dropout_max_width: 0.2

  # トレーニング改善
  use_ema: false                # EMA Teacher（Phase 2で有効化）
  ema_decay: 0.999
  huber_loss: true              # Huber損失
  huber_delta: 0.01
  multi_horizon_weights: [1.0, 0.8, 0.7, 0.5, 0.3]

  # データ改善
  online_normalization: false   # オンライン正規化（Phase 2で有効化）
  memory_map: false             # メモリマップ
  compile_model: false          # torch.compile（Phase 3で有効化）

  # 監視改善
  enable_wandb: false           # W&Bロギング（Phase 3で有効化）
  enable_tensorboard: true      # TensorBoardロギング
  log_grad_norm: false          # 勾配ノルムロギング

  # 堅牢性改善
  auto_recover_oom: false       # OOM自動回復（Phase 3で有効化）
  emergency_checkpoint: false   # 緊急CKPT保存

# Hydra設定
hydra:
  run:
    dir: logs/${now:%Y-%m-%d}/${now:%H-%M-%S}
  sweep:
    dir: logs/multirun/${now:%Y-%m-%d}/${now:%H-%M-%S}
    subdir: ${hydra.job.num}
  job:
    name: ATFT-GAT-FAN
    chdir: false  # 重要: 作業ディレクトリを変更しない
