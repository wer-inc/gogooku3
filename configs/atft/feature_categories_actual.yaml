# Actual Feature Category Mapping
# Based on real dataset columns (193 features total)
# Generated from ml_dataset_20251001_154821_full.parquet

feature_categories:
  # ============================================================================
  # Basic price/volume features - 18 features
  # ============================================================================
  basic:
    - Open
    - High
    - Low
    - Close
    - Volume
    - TurnoverValue
    - row_idx
    - dollar_volume
    - high_low_ratio
    - close_to_high
    - close_to_low
    - volume_ma_5
    - volume_ma_20
    - volume_ratio_5
    - volume_ratio_20
    - ADV20_shares
    - shares_outstanding
    - Section

  # ============================================================================
  # Technical indicators - 25 features
  # ============================================================================
  technical:
    - rsi_2
    - rsi_14
    - rsi_delta
    - stoch_k
    - macd
    - macd_signal
    - macd_histogram
    - adx_14
    - atr_14
    - bb_width
    - bb_pct_b
    - bb_position
    - volatility_5d
    - volatility_10d
    - volatility_20d
    - volatility_60d
    - realized_volatility
    - alpha_1d
    - alpha_5d
    - alpha_vs_regime
    - beta_20d_raw
    - beta_60d
    - beta_60d_raw
    - beta_rolling
    - beta_stability_60d

  # ============================================================================
  # Moving average derived - 16 features
  # ============================================================================
  ma_derived:
    - sma_5
    - sma_10
    - sma_20
    - sma_60
    - sma_120
    - ema_5
    - ema_10
    - ema_20
    - ema_60
    - ema_200
    - price_to_sma5
    - price_to_sma20
    - price_to_sma60
    - ma_gap_5_20
    - ma_gap_20_60
    - mkt_ema20_slope_3

  # ============================================================================
  # Returns features - 16 features
  # ============================================================================
  returns:
    - returns_1d
    - returns_5d
    - returns_10d
    - returns_20d
    - returns_60d
    - returns_120d
    - log_returns_1d
    - log_returns_5d
    - log_returns_10d
    - log_returns_20d
    - feat_ret_1d
    - feat_ret_5d
    - feat_ret_10d
    - feat_ret_20d
    - rel_strength_5d
    - idio_vol_ratio

  # ============================================================================
  # Market features - 27 features (mkt_* prefix)
  # ============================================================================
  market:
    - mkt_ret_1d
    - mkt_ret_5d
    - mkt_ret_10d
    - mkt_ret_20d
    - mkt_ret_1d_z
    - mkt_vol_20d
    - mkt_vol_20d_z
    - mkt_atr_14
    - mkt_natr_14
    - mkt_ema_5
    - mkt_ema_20
    - mkt_ema_60
    - mkt_ema_200
    - mkt_gap_5_20
    - mkt_dev_20
    - mkt_bb_pct_b
    - mkt_bb_bw
    - mkt_bb_bw_z
    - mkt_dd_from_peak
    - mkt_dd_from_peak_z
    - mkt_trend_up
    - mkt_bull_200
    - mkt_high_vol
    - mkt_squeeze
    - mkt_big_move_flag
    - breadth_pos
    - trend_align_mkt

  # ============================================================================
  # Investment flows - 42 features (flow_* prefix)
  # ============================================================================
  flows:
    # Foreign investor flows
    - flow_foreign_net_pos
    - flow_foreign_net_ratio
    - flow_foreign_net_z
    - flow_foreign_share
    - foreigners_net_ratio
    - foreign_share_activity

    # Individual investor flows
    - flow_individual_net_ratio
    - flow_individual_net_z
    - individuals_net_ratio

    # Smart money indicators
    - flow_smart_idx
    - flow_smart_mom4
    - flow_smart_pos
    - smart_money_idx
    - smart_money_mom4

    # Flow activity metrics
    - flow_activity_high
    - flow_activity_low
    - flow_activity_ratio
    - flow_activity_z
    - activity_ratio
    - activity_z

    # Flow breadth and dynamics
    - flow_breadth_pos
    - flow_days_since
    - flow_impulse
    - flow_shock_flag
    - days_since_flow
    - is_flow_valid

    # Margin trading (long positions)
    - LongMarginTradeVolume
    - LongStandardizedMarginTradeVolume
    - LongNegotiableMarginTradeVolume
    - margin_long_tot
    - margin_long_to_adv20
    - margin_d_long_to_adv20
    - margin_d_long_wow
    - long_z52

    # Margin trading (short positions)
    - ShortMarginTradeVolume
    - ShortStandardizedMarginTradeVolume
    - ShortNegotiableMarginTradeVolume
    - margin_short_tot
    - margin_short_to_adv20
    - margin_d_short_to_adv20
    - margin_d_short_wow
    - short_z52

    # Margin aggregates
    - margin_net
    - margin_total_gross
    - margin_credit_ratio
    - margin_imbalance
    - margin_d_net_wow
    - margin_d_ratio_wow
    - margin_gross_mom4
    - margin_gross_z52
    - margin_impulse
    - ratio_z52

    # Margin metadata
    - margin_neg_share_long
    - margin_neg_share_short
    - margin_std_share_long
    - margin_std_share_short
    - margin_days_since
    - margin_issue_type
    - is_margin_valid

  # ============================================================================
  # Financial statements - 16 features (stmt_* prefix)
  # ============================================================================
  statements:
    - stmt_roe
    - stmt_roa
    - stmt_npm
    - stmt_opm
    - stmt_profit_margin
    - stmt_yoy_sales
    - stmt_yoy_op
    - stmt_yoy_np
    - stmt_revenue_growth
    - stmt_rev_fore_op
    - stmt_rev_fore_np
    - stmt_rev_fore_eps
    - stmt_rev_div_fore
    - stmt_progress_op
    - stmt_progress_np
    - stmt_change_in_est
    - stmt_days_since_statement
    - stmt_imp_statement
    - stmt_nc_flag
    - is_stmt_valid

  # ============================================================================
  # Additional/metadata - 13 features
  # ============================================================================
  additional:
    - IssueType
    - LocalCode
    - PublishedDate
    - section_norm
    - is_section_fallback
    - is_borrowable
    - effective_start
    - target_1d_binary
    - target_5d_binary
    - target_10d_binary
    - target_20d_binary

# ============================================================================
# Expected counts (actual from dataset)
# ============================================================================
expected_counts:
  basic: 18
  technical: 25
  ma_derived: 16
  returns: 16
  market: 27
  flows: 59        # Includes margin trading (33 features)
  statements: 20
  additional: 11
  total: 192       # 193 - 1 duplicate (Volume appears twice)

# ============================================================================
# Model input dimensions (for ATFT-GAT-FAN config)
# ============================================================================
model_input_dims:
  # VSN dimensions per group
  basic_features: 18
  technical_features: 25
  ma_derived_features: 16
  returns_features: 16
  market_features: 27
  flows_features: 59
  statements_features: 20
  additional_features: 11

  # Total
  total_features: 192

# ============================================================================
# Feature engineering notes
# ============================================================================
notes:
  - "Flow features include both institutional flow data and margin trading"
  - "Margin trading has 33 features (long/short positions, aggregates, metadata)"
  - "Smart money indicators derived from flow patterns"
  - "Statement features include growth rates and forecast revisions"
  - "Binary target flags are for classification tasks (in additional)"
  - "One duplicate 'Volume' column exists (basic has both 'Volume' and 'volume')"
