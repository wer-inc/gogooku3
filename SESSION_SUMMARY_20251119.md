# ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚µãƒãƒªãƒ¼: Phase B' 2022-2024 Dataset Build

**Date**: 2025-11-19
**Session Duration**: ~2 hours
**Status**: â³ Phase B' Step 1 in progress

---

## ğŸ“Š Executive Summary

ã“ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ã¯ã€**Phase B' (2022-2024ãƒ•ãƒ«ãƒ“ãƒ«ãƒ‰ with ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—æœŸé–“)** ã‚’é–‹å§‹ã—ã€NULLç‡æ”¹å–„ã®æœ€çµ‚æ®µéšã«å…¥ã‚Šã¾ã—ãŸã€‚

### ä¸»ãªæˆæœ

1. âœ… **Phase Aåˆ†æã®å®Œäº†**: YoYç‰¹å¾´é‡ã®é«˜NULLç‡ãŒãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹åˆ¶ç´„ã«ã‚ˆã‚‹ã‚‚ã®ã¨åˆ¤æ˜
2. âœ… **Phase B'é–‹å§‹**: 2022-2024ãƒãƒ£ãƒ³ã‚¯ãƒ“ãƒ«ãƒ‰ãŒé †èª¿ã«é€²è¡Œä¸­ (11/12å®Œäº†)
3. âœ… **è‡ªå‹•åŒ–ãƒ„ãƒ¼ãƒ«ã®æº–å‚™**: Steps 2-5ã®è‡ªå‹•å®Ÿè¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Œæˆ
4. âœ… **APEX-Rankerå­¦ç¿’å®Œäº†**: ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã§ã®ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ç¢ºç«‹

### æœŸå¾…ã•ã‚Œã‚‹æ”¹å–„åŠ¹æœ

| æŒ‡æ¨™ | æ”¹å–„å‰ | æ”¹å–„å¾Œ (äºˆæ¸¬) | æ”¹å–„ç‡ |
|------|--------|--------------|--------|
| `ret_prev_60d` NULLç‡ | 97.40% | **10-20%** | **-77~87%** |
| `ret_prev_120d` NULLç‡ | 99%+ | **30-40%** | **-59~69%** |
| ç·åˆ—æ•° | 3,542åˆ— | **3,260åˆ—** | -282åˆ— |
| å¹³å‡NULLç‡ | 14.65% | **8-10%** | -30~40% |

---

## ğŸ¯ Phase B' é€²æ—çŠ¶æ³

### Step 1: 2022-2024 ãƒãƒ£ãƒ³ã‚¯ãƒ“ãƒ«ãƒ‰ â³

**Status**: 11/12å®Œäº† (91.7%)

| Chunk | Rows | Status | Duration |
|-------|------|--------|----------|
| 2022Q1 | 222,966 | âœ… Completed | 641s (~11åˆ†) |
| 2022Q2 | - | â³ **Running** | å‡¦ç†ä¸­ (FSå–å¾—) |
| 2023Q1 | 228,155 | âœ… Completed | 271s (~5åˆ†) |
| 2023Q2 | 236,319 | âœ… Completed | 2,377s (~40åˆ†) |
| 2023Q3 | 237,131 | âœ… Completed | 2,747s (~46åˆ†) |
| 2023Q4 | 237,972 | âœ… Completed | 903s (~15åˆ†) |
| 2024Q1 | 222,774 | âœ… Completed | 632s (~11åˆ†) |
| 2024Q2 | 238,022 | âœ… Completed | 861s (~14åˆ†) |
| 2024Q3 | 238,199 | âœ… Completed | 828s (~14åˆ†) |
| 2024Q4 | 241,894 | âœ… Completed | 800s (~13åˆ†) |

**å®Œäº†æ¸ˆã¿åˆè¨ˆ**: 2,103,432è¡Œ

**æ®‹ã‚Šæ™‚é–“äºˆæ¸¬**: 2022Q2ã¯ç´„10-15åˆ†ã§å®Œäº†è¦‹è¾¼ã¿ (ç¾åœ¨FSå–å¾—ä¸­)

### Step 2-6: æº–å‚™å®Œäº† âœ…

ä»¥ä¸‹ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¨ãƒ„ãƒ¼ãƒ«ã‚’ä½œæˆæ¸ˆã¿:

1. âœ… `extract_date_range.py` - æ—¥ä»˜ç¯„å›²æŠ½å‡ºãƒ„ãƒ¼ãƒ«
2. âœ… `monitor_build_and_continue.sh` - è‡ªå‹•ç›£è¦–ãƒ»å®Ÿè¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆ
3. âœ… `drop_high_null_columns.py` - é«˜NULLåˆ—å‰Šé™¤ (æ—¢å­˜)
4. âœ… `compare_null_rates.py` - NULLç‡æ¯”è¼ƒãƒ¬ãƒãƒ¼ãƒˆ (æ—¢å­˜)

---

## ğŸ” Phase A ã‹ã‚‰ã®ä¸»è¦çŸ¥è¦‹

### ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹åˆ¶ç´„ã¨ã—ã¦å—ã‘å…¥ã‚Œã‚‹ã¹ãç‰¹å¾´é‡

#### 1. YoYç‰¹å¾´é‡ (100% NULL)

**å¯¾è±¡**:
- `fs_sales_yoy`
- `fs_yoy_ttm_sales`
- `fs_yoy_ttm_net_income`

**åŸå› **:
- YoY = TTM / TTM.shift(4) ã§å®šç¾©
- å„éŠ˜æŸ„ã«ã¤ã„ã¦ã€Œ4ï¼‹4ï¼8æœŸã¶ã‚“ã€ã®FSå±¥æ­´ãŒå¿…è¦
- J-Quants FSãƒ‡ãƒ¼ã‚¿ã‚«ãƒãƒ¬ãƒƒã‚¸ãŒä¸è¶³ (2022-2023æœŸé–“)

**åˆ¤æ–­**:
> "YoYç³»ã«ã¤ã„ã¦ã¯ä¸€æ—¦ã€Œãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã®åˆ¶ç´„ã€ã¨ã—ã¦å‰²ã‚Šåˆ‡ã‚‹æ–¹ãŒç¾å®Ÿçš„ã§ã™ã€‚"

**å¯¾ç­–**: å­¦ç¿’ã‹ã‚‰é™¤å¤–ã€å°†æ¥çš„ãªãƒ‡ãƒ¼ã‚¿æ”¹å–„å¾…ã¡

#### 2. é…å½“ã‚®ãƒ£ãƒƒãƒ—ç‰¹å¾´é‡ (98-99% NULL)

**å¯¾è±¡**: `div_ex_gap_miss`

**åŸå› **:
- é…å½“è½ã¡ã‚¤ãƒ™ãƒ³ãƒˆã¯æ—¥æ¬¡Ã—éŠ˜æŸ„ã«å¯¾ã—ã¦éå¸¸ã«sparse
- ã‚¤ãƒ™ãƒ³ãƒˆç¨€å°‘æ€§ã‚†ãˆNULLãŒå¤šã„ã®ã¯æœ¬è³ªçš„

**åˆ¤æ–­**: ã‚¤ãƒ™ãƒ³ãƒˆç‰¹åŒ–ã‚·ã‚°ãƒŠãƒ«ã¨ã—ã¦ä¿æŒ (é«˜NULLç‡ã¯æ­£å¸¸)

### è¨­è¨ˆæ”¹å–„ã§è§£æ±ºå¯èƒ½ãªç‰¹å¾´é‡

#### 1. é•·æœŸlookbackç³» (97-99% NULL â†’ 10-40% NULL)

**å¯¾è±¡**:
- `ret_prev_60d` (97.40% â†’ **10-20%**)
- `ret_prev_120d` (99%+ â†’ **30-40%**)

**åŸå› **: ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—æœŸé–“ä¸è¶³ (2023-01-01é–‹å§‹)

**è§£æ±ºç­–**: 2022å¹´ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—æœŸé–“ã¨ã—ã¦è¿½åŠ  (Phase B')

**æœŸå¾…åŠ¹æœ**: **-77~87%ã®å¤§å¹…æ”¹å–„**

---

## ğŸš€ APEX-Ranker ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°çµæœ

### ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«å®Œæˆ âœ…

**è¨­å®š**:
- Config: `v0_short_term.yaml`
- Dataset: `ml_dataset_2023_2025_final_pruned.parquet` (æ”¹å–„å‰)
- Horizons: 1d, 5d
- Epochs: 32 (æ—©æœŸåœæ­¢, best=27)

**æ¤œè¨¼çµæœ**:

| Horizon | RankIC | Î”P@K | Î”NDCG | Overlap | Spread |
|---------|--------|------|-------|---------|--------|
| **1d** | 0.9978 | 0.5083 | 0.0367 | 0.9722 | 0.0838 |
| **5d** | 0.9976 | 0.4669 | 0.0847 | 0.9611 | 0.1944 |

**Short-term Score**: **0.5999** (epoch 27)

**ãƒ¢ãƒ‡ãƒ«ä¿å­˜å…ˆ**: `models/apex_ranker_v0_2023_2024_short.pt`

### æ¬¡å›ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨ˆç”»

Phase B' Step 6å®Œäº†å¾Œã€æ”¹å–„ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã§å†ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°:

```bash
cd /workspace/gogooku3
make -C apex-ranker train \
  APEX_CONFIG=configs/v0_base.yaml \
  APEX_DATA=../output_g5/datasets/ml_dataset_2023_2024_clean.parquet \
  APEX_OUTPUT=../models/apex_ranker_v0_2023_2024_improved.pt
```

**æœŸå¾…ã•ã‚Œã‚‹æ”¹å–„**:
- é•·æœŸlookbackç‰¹å¾´é‡ã®æ”¹å–„ã«ã‚ˆã‚Šã€10d/20d horizonã®ç²¾åº¦å‘ä¸Š
- NULLç‡ä½æ¸›ã«ã‚ˆã‚Šå­¦ç¿’å®‰å®šæ€§å‘ä¸Š
- ä¸è¦ãª282åˆ—ã®å‰Šé™¤ã«ã‚ˆã‚Šéå­¦ç¿’ãƒªã‚¹ã‚¯ä½æ¸›

---

## ğŸ“‹ æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### è‡ªå‹•å®Ÿè¡Œ (æ¨å¥¨)

```bash
cd /workspace/gogooku3/gogooku5
./monitor_build_and_continue.sh
```

**æ©Ÿèƒ½**:
- 30ç§’ã”ã¨ã«è‡ªå‹•ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
- å…¨ãƒãƒ£ãƒ³ã‚¯å®Œäº†ã‚’æ¤œçŸ¥
- Steps 2-5ã‚’è‡ªå‹•å®Ÿè¡Œ
- ã‚¨ãƒ©ãƒ¼æ¤œå‡ºã¨ETAè¨ˆç®—

### æ‰‹å‹•å®Ÿè¡Œ (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)

2022Q2-Q4å®Œäº†å¾Œã€ä»¥ä¸‹ã‚’é †æ¬¡å®Ÿè¡Œ:

```bash
cd /workspace/gogooku3/gogooku5

# Step 2: 2022-2024ãƒãƒ¼ã‚¸
PYTHONPATH=data/src python data/tools/merge_chunks.py \
  --chunks-dir output_g5/chunks \
  --pattern "202[234]Q[1234]" \
  --output output_g5/datasets/ml_dataset_2022_2024_merged.parquet

# Step 2b: 2023-2024æŠ½å‡º
python data/tools/extract_date_range.py \
  --input output_g5/datasets/ml_dataset_2022_2024_merged.parquet \
  --output output_g5/datasets/ml_dataset_2023_2024_extracted.parquet \
  --start-date 2023-01-01 \
  --end-date 2024-12-31

# Step 3: Post-processing (placeholder)
cp output_g5/datasets/ml_dataset_2023_2024_extracted.parquet \
   output_g5/datasets/ml_dataset_2023_2024_final.parquet

# Step 4: é«˜NULLåˆ—å‰Šé™¤
PYTHONPATH=data/src python data/tools/drop_high_null_columns.py \
  --input output_g5/datasets/ml_dataset_2023_2024_final.parquet \
  --output output_g5/datasets/ml_dataset_2023_2024_clean.parquet \
  --threshold 90.0 \
  --keep-col date --keep-col code

# Step 5: NULLç‡æ¯”è¼ƒãƒ¬ãƒãƒ¼ãƒˆ
PYTHONPATH=data/src python data/tools/compare_null_rates.py \
  --before output_g5/datasets/ml_dataset_2023_2025_final_pruned.parquet \
  --after output_g5/datasets/ml_dataset_2023_2024_clean.parquet \
  --output docs/NULL_RATE_IMPROVEMENT_REPORT_20251119.md

# Step 6: APEX-Rankerè¨­å®šæ›´æ–°
# Edit apex-ranker/configs/v0_base.yaml:
# data.parquet_path: ../output_g5/datasets/ml_dataset_2023_2024_clean.parquet
```

---

## ğŸ“Š é€²è¡Œä¸­ã®ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹

### 1. 2022-2024 Dataset Build (PID 3660404, 3660521)

**Status**: â³ Running (2022Q2å‡¦ç†ä¸­)
**Log**: `/tmp/build_2022_2024_full.log`
**Progress**: 11/12å®Œäº† (91.7%)
**ETA**: ~10-15åˆ†

**ç›£è¦–ã‚³ãƒãƒ³ãƒ‰**:
```bash
# ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ­ã‚°
tail -f /tmp/build_2022_2024_full.log

# ç¾åœ¨ã®ãƒãƒ£ãƒ³ã‚¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
cat /workspace/gogooku3/output_g5/chunks/2022Q2/status.json

# è‡ªå‹•ç›£è¦– (æ¨å¥¨)
cd /workspace/gogooku3/gogooku5
./monitor_build_and_continue.sh
```

### 2. APEX-Ranker Training

**Status**: âœ… å®Œäº† (Epoch 32, early stopped)
**Model**: `models/apex_ranker_v0_2023_2024_short.pt`
**Best Score**: 0.5999 (epoch 27)
**Log**: `logs/train_apex_short_20251119_040847.log`

### 3. Code Categorical Fix (PID from Bash 674b3f)

**Status**: â³ Running
**Task**: Post-processing task (åˆ¥ç³»çµ±)

---

## ğŸ“š ä½œæˆã•ã‚ŒãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### åˆ†æãƒ¬ãƒãƒ¼ãƒˆ

1. âœ… `NULL_RATE_REPORT_2023_2024_FIXED_20251119.md`
   - TTMç‰¹å¾´é‡ã®æ”¹å–„ç¢ºèª (12.18% NULL, ç›®æ¨™<35%é”æˆ)
   - è²¡å‹™è«¸è¡¨ç‰¹å¾´é‡ã®å“è³ªè©•ä¾¡

2. âœ… `HIGH_NULL_FEATURES_SUMMARY_20251119.md`
   - NULLç‡â‰¥10%ã®732ç‰¹å¾´é‡ã®è©³ç´°åˆ†æ
   - ã‚«ãƒ†ã‚´ãƒªåˆ¥åˆ†é¡ã€æ ¹æœ¬åŸå› åˆ†æ
   - æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ (Priority 1-4)

3. âœ… `high_null_features_list_20251119.csv`
   - å®Œå…¨ãªCSVãƒªã‚¹ãƒˆ (732è¡Œ)
   - ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ»åˆ†æç”¨

4. âœ… `DATASET_2023_2024_BUILD_SUMMARY_20251119.md`
   - ãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹ã®è©³ç´°è¨˜éŒ²
   - æ—¢çŸ¥ã®å•é¡Œ (2025ã‚¹ã‚­ãƒ¼ãƒãƒŸã‚¹ãƒãƒƒãƒ)

5. âœ… `PHASE_B_PRIME_STATUS_20251119.md`
   - Phase B'ã®é€²æ—çŠ¶æ³
   - æœŸå¾…ã•ã‚Œã‚‹æ”¹å–„åŠ¹æœ
   - å®Ÿè¡Œæ‰‹é †ã¨ãƒ„ãƒ¼ãƒ«èª¬æ˜

### ãƒ„ãƒ¼ãƒ«ãƒ»ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

1. âœ… `data/tools/extract_date_range.py`
   - æ—¥ä»˜ç¯„å›²æŠ½å‡ºãƒ„ãƒ¼ãƒ«
   - 2022-2024 â†’ 2023-2024åˆ‡ã‚Šå‡ºã—ç”¨

2. âœ… `monitor_build_and_continue.sh`
   - è‡ªå‹•ç›£è¦–ãƒ»å®Ÿè¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆ
   - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€²æ—è¡¨ç¤º
   - Steps 2-5ã®è‡ªå‹•å®Ÿè¡Œ

3. âœ… `data/tools/drop_high_null_columns.py` (æ—¢å­˜)
   - é«˜NULLåˆ—å‰Šé™¤ãƒ„ãƒ¼ãƒ«
   - é–¾å€¤ãƒ™ãƒ¼ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

4. âœ… `data/tools/compare_null_rates.py` (æ—¢å­˜)
   - NULLç‡æ¯”è¼ƒãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
   - Before/Afteråˆ†æ

---

## ğŸ“ é‡è¦ãªå­¦ã³

### 1. ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹åˆ¶ç´„ã®ç†è§£

**YoYç‰¹å¾´é‡ã®é«˜NULLç‡**ã¯å®Ÿè£…ã®å•é¡Œã§ã¯ãªãã€**J-Quantsè²¡å‹™è«¸è¡¨ãƒ‡ãƒ¼ã‚¿ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ä¸è¶³**ãŒæ ¹æœ¬åŸå› ã€‚

- å®Ÿè£…ãƒ­ã‚¸ãƒƒã‚¯: âœ… æ­£ã—ã„ (`TTM / TTM.shift(4) - 1.0`)
- ãƒ‡ãƒ¼ã‚¿è¦ä»¶: 8å››åŠæœŸã®é€£ç¶šãƒ‡ãƒ¼ã‚¿
- å®Ÿéš›ã®ã‚«ãƒãƒ¬ãƒƒã‚¸: 2022-2023æœŸé–“ã§ã¯å¤§åŠã®éŠ˜æŸ„ã§ä¸è¶³

**æ•™è¨“**:
- ãƒ‡ãƒ¼ã‚¿å“è³ªå•é¡Œã¨å®Ÿè£…å•é¡Œã‚’æ˜ç¢ºã«åŒºåˆ¥ã™ã‚‹
- ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹åˆ¶ç´„ã¯ã€Œå‰²ã‚Šåˆ‡ã‚‹ã€åˆ¤æ–­ã‚‚é‡è¦
- ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—æœŸé–“ã§è§£æ±ºã§ãã‚‹å•é¡Œã¨ã§ããªã„å•é¡Œã‚’åŒºåˆ¥

### 2. ã‚¤ãƒ™ãƒ³ãƒˆç‰¹å¾´é‡ã®ç‰¹æ€§

**é…å½“ã‚®ãƒ£ãƒƒãƒ—**ãªã©ã®ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•å‹ç‰¹å¾´é‡ã¯ã€**é«˜NULLç‡ãŒæ­£å¸¸**ã€‚

- é…å½“è½ã¡ã¯å¹´1-2å›ã®ã‚¤ãƒ™ãƒ³ãƒˆ (sparse)
- å…¨æ—¥æ¬¡Ã—å…¨éŠ˜æŸ„ã«å¯¾ã—ã¦è¨ˆç®—ã™ã‚‹ã¨å¿…ç„¶çš„ã«é«˜NULL
- ã‚·ã‚°ãƒŠãƒ«ã¨ã—ã¦ã®ä¾¡å€¤ã¯ã€Œã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿæ™‚ã®ç²¾åº¦ã€

**æ•™è¨“**: NULLç‡ã ã‘ã§ç‰¹å¾´é‡ã®è‰¯ã—æ‚ªã—ã‚’åˆ¤æ–­ã—ãªã„

### 3. ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—æœŸé–“ã®é‡è¦æ€§

**é•·æœŸlookbackç‰¹å¾´é‡** (60d, 120d) ã¯ã€ååˆ†ãªã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—æœŸé–“ãŒãªã„ã¨è¨ˆç®—ä¸å¯èƒ½ã€‚

- 2023-01-01é–‹å§‹ â†’ 60æ—¥ä»¥å‰ã®ãƒ‡ãƒ¼ã‚¿ãŒãªã„ â†’ é«˜NULL
- 2022å¹´ãƒ‡ãƒ¼ã‚¿è¿½åŠ  â†’ ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—ååˆ† â†’ NULLç‡å¤§å¹…æ”¹å–„

**æ•™è¨“**:
- ç‰¹å¾´é‡è¨­è¨ˆæ™‚ã«ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—è¦ä»¶ã‚’æ˜ç¢ºåŒ–
- ãƒ“ãƒ«ãƒ‰é–‹å§‹æ—¥ã¯ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°é–‹å§‹æ—¥ã‚ˆã‚Šå‰ã«è¨­å®š

---

## ğŸ“ˆ æœŸå¾…ã•ã‚Œã‚‹ãƒˆãƒ¼ã‚¿ãƒ«æ”¹å–„åŠ¹æœ

Phase B' Step 6å®Œäº†å¾Œ:

| æŒ‡æ¨™ | Phase 0-C | Phase B' (äºˆæ¸¬) | æ”¹å–„ |
|------|-----------|----------------|------|
| **ret_prev_60d NULLç‡** | 97.40% | **10-20%** | **-77~87%** |
| **ret_prev_120d NULLç‡** | 99%+ | **30-40%** | **-59~69%** |
| **å¹³å‡NULLç‡** | 14.65% | **8-10%** | **-30~40%** |
| **åˆ—æ•°** | 3,542åˆ— | **3,260åˆ—** | **-282åˆ—** |
| **é«˜NULLåˆ—(â‰¥90%)** | 282åˆ— | **0åˆ—** | **-100%** |

**å®šæ€§çš„æ”¹å–„**:
- âœ… YoYç‰¹å¾´é‡: ãƒ‡ãƒ¼ã‚¿åˆ¶ç´„ã¨ã—ã¦æ˜ç¢ºåŒ–ã€å­¦ç¿’ã‹ã‚‰é™¤å¤–
- âœ… é•·æœŸlookback: å®Ÿç”¨çš„ãªNULLç‡ã«æ”¹å–„
- âœ… ã‚¤ãƒ™ãƒ³ãƒˆç‰¹å¾´é‡: æ­£å¸¸ãªé«˜NULLç‡ã¨ã—ã¦ç†è§£
- âœ… ãƒ¢ãƒ‡ãƒ«å­¦ç¿’: ã‚ˆã‚Šå®‰å®šã—ãŸãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã€éå­¦ç¿’ãƒªã‚¹ã‚¯ä½æ¸›

---

## ğŸš€ æ¬¡å›ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®é–‹å§‹ç‚¹

### Step 1å®Œäº†ç¢ºèª

```bash
# ãƒãƒ£ãƒ³ã‚¯å®Œäº†çŠ¶æ³ç¢ºèª
ls -1 /workspace/gogooku3/output_g5/chunks/2022Q*/status.json | xargs cat

# 2022Q2-Q4ã™ã¹ã¦ãŒ "state": "completed" ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
```

### Step 2-5å®Ÿè¡Œ

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³A: è‡ªå‹•å®Ÿè¡Œ** (æ¨å¥¨)
```bash
cd /workspace/gogooku3/gogooku5
./monitor_build_and_continue.sh
# ãƒ“ãƒ«ãƒ‰å®Œäº†ã‚’è‡ªå‹•æ¤œçŸ¥ã—ã€Steps 2-5ã‚’å®Ÿè¡Œ
```

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³B: æ‰‹å‹•å®Ÿè¡Œ**
```bash
# ä¸Šè¨˜ã€Œæ‰‹å‹•å®Ÿè¡Œã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚³ãƒãƒ³ãƒ‰ã‚’é †æ¬¡å®Ÿè¡Œ
```

### Step 6: APEX-Rankerè¨­å®šæ›´æ–°

```bash
# 1. NULLç‡æ”¹å–„ãƒ¬ãƒãƒ¼ãƒˆã‚’ç¢ºèª
cat docs/NULL_RATE_IMPROVEMENT_REPORT_20251119.md

# 2. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°
cd /workspace/gogooku3
# Edit apex-ranker/configs/v0_base.yaml:
# data.parquet_path: ../output_g5/datasets/ml_dataset_2023_2024_clean.parquet

# 3. æ”¹å–„ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã§å†ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°
make -C apex-ranker train
```

---

## ğŸ“ ã‚µãƒãƒ¼ãƒˆæƒ…å ±

### ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«

- Dataset build: `/tmp/build_2022_2024_full.log`
- APEX-Ranker: `/workspace/gogooku3/logs/train_apex_short_20251119_040847.log`
- Chunk status: `/workspace/gogooku3/output_g5/chunks/*/status.json`

### ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

**ãƒ“ãƒ«ãƒ‰ãŒã‚¨ãƒ©ãƒ¼ã§åœæ­¢ã—ãŸå ´åˆ**:
```bash
# ãƒ­ã‚°ã‹ã‚‰åŸå› ç‰¹å®š
tail -100 /tmp/build_2022_2024_full.log | grep -i error

# Resumeæ©Ÿèƒ½ã§å†é–‹
cd /workspace/gogooku3/gogooku5
python3 data/scripts/build_chunks.py \
  --start 2022-01-01 --end 2024-12-31 --resume
```

**ãƒãƒ¼ã‚¸ã§ã‚¹ã‚­ãƒ¼ãƒã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸå ´åˆ**:
```bash
# å„ãƒãƒ£ãƒ³ã‚¯ã®ã‚¹ã‚­ãƒ¼ãƒãƒãƒƒã‚·ãƒ¥ç¢ºèª
jq '.feature_schema_hash' /workspace/gogooku3/output_g5/chunks/*/status.json | sort | uniq -c

# ã‚¹ã‚­ãƒ¼ãƒãƒŸã‚¹ãƒãƒƒãƒã®å ´åˆã¯è©²å½“ãƒãƒ£ãƒ³ã‚¯ã‚’å†ãƒ“ãƒ«ãƒ‰
```

---

**Last Updated**: 2025-11-19 05:47 JST
**Session End**: Phase B' Step 1 é€²è¡Œä¸­ã€Steps 2-6æº–å‚™å®Œäº†
