name: jpx_large_scale

# スキーマ設定 (required)
schema:
  date_column: Date  # Note: parquet files use capital 'D'
  code_column: Code  # Note: parquet files use capital 'C'
  target_column: feat_ret  # Base name for target column generation
  target_columns:  # Explicit target columns for multi-horizon prediction
    - feat_ret_1d
    - feat_ret_5d
    - feat_ret_10d
    - feat_ret_20d
  feature_columns:
    - returns_1d_cs_z
    - returns_5d_cs_z
    - log_returns_1d_cs_z
    - volatility_5d_cs_z
    - volatility_20d_cs_z
    - ema_5_cs_z
    - ema_20_cs_z
    - ema_200_cs_z
    - ma_gap_5_20_cs_z
    - price_to_sma20_cs_z
    - bb_position_cs_z
    - bb_width_cs_z
    - volume_ratio_5_cs_z
    - volume_ratio_20_cs_z
    - turnover_rate_cs_z
    - mkt_ret_1d_cs_z
    - mkt_ret_5d_cs_z
    - mkt_gap_5_20_cs_z
    - mkt_vol_20d_cs_z
    - mkt_bull_200_cs_z
    - mkt_high_vol_cs_z
    - mkt_ret_1d_z_cs_z
    - mkt_dd_from_peak_cs_z
    - beta_60d_cs_z
    - alpha_1d_cs_z
    - alpha_5d_cs_z
    - rel_strength_5d_cs_z
    - idio_vol_ratio_cs_z
    - trend_align_mkt_cs_z
    - sec_mom_20_cs_z
    - sec_ret_5d_eq_cs_z
    - sec_vol_20_z_cs_z
    - sec_gap_5_20_cs_z
    - flow_foreign_net_z_cs_z
    - flow_individual_net_z_cs_z
    - flow_activity_z_cs_z
    - flow_smart_idx_cs_z
    - flow_smart_mom4_cs_z
    - flow_shock_flag_cs_z
    - flow_impulse_cs_z
    - flow_days_since_cs_z
    - stmt_yoy_sales_cs_z
    - stmt_yoy_op_cs_z
    - stmt_opm_cs_z
    - stmt_progress_op_cs_z
    - stmt_rev_fore_op_cs_z
    - stmt_imp_statement_cs_z
    - stmt_days_since_statement_cs_z
    - returns_10d_cs_z
    - volatility_60d_cs_z
    - price_to_sma5_cs_z
    - price_to_sma60_cs_z
    - close_to_high_cs_z
    - close_to_low_cs_z
    - realized_volatility_cs_z
    - mkt_bb_bw_cs_z
    - mkt_bb_pct_b_cs_z
    - mkt_ret_10d_cs_z
    - mkt_ret_20d_cs_z
    - mkt_ema20_slope_3_cs_z
    - beta_stability_60d_cs_z
    - rsi_2_cs_z
    - rsi_14_cs_z
    - macd_histogram_cs_z
    - stoch_k_cs_z
    - alpha_vs_sec_1d_cs_z
    - flow_foreign_net_ratio_cs_z
    - flow_individual_net_ratio_cs_z
    - flow_activity_ratio_cs_z
    - flow_breadth_pos_cs_z
    - stmt_yoy_np_cs_z
    - stmt_npm_cs_z
    - stmt_progress_np_cs_z
    - stmt_rev_fore_np_cs_z
    - stmt_roe_cs_z
    - stmt_roa_cs_z
    - returns_20d_cs_z
    - volatility_10d_cs_z
    - is_flow_valid
    - is_stmt_valid
    - is_valid_ma
    - is_sec_cs_valid
  static_columns:
    - sector33_code
    - is_borrowable
  regime_columns:
    - mkt_ret_1d
    - mkt_ret_5d
    - mkt_vol_20d
    - mkt_bull_200
    - mkt_high_vol
    - mkt_ret_1d_z
    - mkt_bb_pct_b

# バッファー付きローダーを使用（ファイル境界を跨いだシーケンス生成）
use_buffered_loader: true  # 20日シーケンスのため必須

# データソース（大規模データ用）
source:
  type: parquet  # parquet推奨（高速・高圧縮）
  data_dir: data/raw/large_scale
  file_pattern: "*.parquet"  # または "train_*.parquet"

# メモリ管理
memory:
  chunk_size: 50000  # GPUへのデータ供給を高速化
  cache_size_gb: 15  # キャッシュサイズを増やしてI/O待機を削減
  use_memory_map: true  # メモリマップファイルの使用

# 分散処理設定
distributed:
  enabled: true
  num_workers: 4  # GPU効率を優先（メモリ制約を考慮）
  prefetch_factor: 2  # プリフェッチ倍率を下げてメモリ使用量を削減

# サンプリング設定（スケーラー作成用）
sampling:
  n_files_for_scaler: 10  # スケーラー作成に使うファイル数
  rows_per_file: 10000  # 各ファイルからのサンプル行数

# 時系列設定
time_series:
  sequence_length: 20  # specification_lite.mdに準拠
  prediction_horizons: [1, 5, 10, 20]  # 実データ列 (target_1d/5d/10d/20d) に整合

  # データ分割（時系列を考慮）
  split:
    method: time_based
    train_ratio: 0.7
    val_ratio: 0.15
    test_ratio: 0.15
    gap_days: 5

# 特徴量設定（ML_DATASET_COLUMNS.md準拠）
# NOTE: Curated core50 + plus30 bundles (83 columns incl. masks)
features:
  input_dim: 82
  groups_config: configs/atft/feature_groups.yaml
  enabled_groups:
    - core50
    - plus30

# Expose flattened feature list for training pipeline
feature_cols: ${schema.feature_columns}

# Phase 1 streaming loader configuration
loader:
  implementation: iterable_v1
