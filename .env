# WANDB
WANDB_API_KEY=e9d88303ceecaf6037cfc47d3a8fa275211b138d

# JQuants API認証情報
JQUANTS_AUTH_EMAIL=wer.inc.jp@gmail.com
JQUANTS_AUTH_PASSWORD=aBcDeF123456

# 旧形式の環境変数名（互換性のため）
JQUANTS_EMAIL=wer.inc.jp@gmail.com
JQUANTS_PASSWORD=aBcDeF123456

# BigQuery設定（将来用）
GOOGLE_APPLICATION_CREDENTIALS=/app/config/gogooku-2e409ab2934d.json

# その他の設定
DEBUG=0
TZ=Asia/Tokyo

# プロジェクト設定
PROJECT_NAME=gogooku3
OUTPUT_DIR=/home/ubuntu/gogooku3/output
LOG_LEVEL=INFO

# JQuants API契約範囲（オプション）
# Note: API契約範囲の検証にのみ使用（データ取得範囲には影響しない）
#
# ローリング契約（直近N年）の場合: JQUANTS_CONTRACT_YEARS を設定
JQUANTS_CONTRACT_YEARS=10  # 直近10年の契約（今日から10年前まで）
#
# 固定開始日の契約の場合: JQUANTS_SUBSCRIPTION_START を設定
# JQUANTS_SUBSCRIPTION_START=2015-10-13  # ライトプラン以上の固定契約
# JQUANTS_SUBSCRIPTION_END=  # 空の場合は現在日付まで

# データ取得設定
MAX_CONCURRENT_FETCH=75  # 有料プラン向け設定
USE_CACHE=1  # 価格データのキャッシュを有効化
CACHE_MAX_AGE_DAYS=30  # キャッシュ有効期限（デフォルト7日→30日に延長）
# ML_PIPELINE_START_DATE=2015-10-13  # オプション: 過去データの強制取得（通常は不要）

# GPU設定
FORCE_GPU=1
REQUIRE_GPU=1
USE_GPU_ETL=1
RMM_ALLOCATOR=cuda_async
RMM_POOL_SIZE=40GB
CUDF_SPILL=1
CUDA_VISIBLE_DEVICES=0
PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True

# Numba/RAPIDS compatibility fix
NUMBA_CUDA_ENABLE_PYNVJITLINK=1

# GPU学習デフォルト設定
GPU_TRAINING_ENABLED=1
DEFAULT_LEARNING_RATE=2e-4
DEFAULT_MAX_EPOCHS=75
ADV_GRAPH_TRAIN=1

# DataLoader最適化設定
PREFETCH_FACTOR=8  # バッチプリフェッチ数（バッチ準備時間を短縮）

# Safe mode 設定（FORCE_SINGLE_PROCESS=1時に適用）
SAFE_MODE_BATCH_SIZE=256  # Safe modeでの初期バッチサイズ（デフォルト1024 → 256に削減）
# Note: Safe mode時はPyTorchスレッドも自動的に1に制限されます（デッドロック防止）

# GCS (Google Cloud Storage) 設定
GCS_ENABLED=1
GCS_BUCKET=gogooku-ml-data
GCS_SYNC_AFTER_SAVE=1
LOCAL_CACHE_DIR=/home/ubuntu/gogooku3/output
GOOGLE_APPLICATION_CREDENTIALS=/home/ubuntu/gogooku3/gogooku-b3b34bc07639.json
# === IC=0 Fix Settings (Added 2025-10-15) ===
MC_DROPOUT_VAL=1          # Enable MC Dropout during validation
PRED_VAR_MIN=0.01         # Prediction variance threshold (doubled from 0.005)
PRED_VAR_WEIGHT=0.3       # Prediction variance penalty (tripled from 0.1)

# === Training Goal Settings (Added 2025-10-15) ===
# Target: Sharpe Ratio = 0.849 (from CLAUDE.md)

# Early Stopping Configuration
EARLY_STOP_METRIC=val_rankic     # Monitor RankIC (financial metric)
EARLY_STOP_MAXIMIZE=1            # Higher RankIC is better
EARLY_STOP_PATIENCE=12           # Allow 12 epochs without improvement
EARLY_STOP_MIN_DELTA=0.001       # Minimum significant improvement

# Checkpoint Saving Strategy
SAVE_BEST_RANKIC=1               # Save best RankIC model (for production)
SAVE_BEST_SHARPE=1               # Save best Sharpe model (for evaluation)
SAVE_PHASE_CHECKPOINTS=1         # Save snapshot at end of each phase
